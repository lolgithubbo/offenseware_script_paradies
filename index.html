<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lua Scripts Community</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      margin: 0; padding: 0; color: #333;
    }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    .hidden { display: none; }
    .box {
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      padding: 20px; margin-bottom: 20px;
    }
    input, textarea {
      width: 100%; padding: 10px; margin: 6px 0;
      border-radius: 6px; border: 1px solid #ccc;
    }
    button {
      padding: 8px 16px; border: none; border-radius: 8px;
      cursor: pointer; font-weight: bold;
    }
    .btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); color: #fff; }
    .btn-like { background: #f8f9fa; border: 1px solid #ccc; }
    .welcome-message { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
    .owner { background: linear-gradient(45deg, #4caf50, #45a049); color: #fff; }
    .user { background: linear-gradient(45deg, #e53935, #d32f2f); color: #fff; }
    .script-card { background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåô Lua Scripts Community</h1>

    <!-- Registrierung -->
    <div id="registerBox" class="box">
      <h2>üìù Registrieren</h2>
      <input type="text" id="regUsername" placeholder="Benutzername" required>
      <input type="email" id="regEmail" placeholder="E-Mail" required>
      <input type="password" id="regPassword" placeholder="Passwort" required>
      <button class="btn-primary" onclick="register()">Registrieren</button>
    </div>

    <!-- Login -->
    <div id="loginBox" class="box hidden">
      <h2>üîë Login</h2>
      <input type="email" id="loginEmail" placeholder="E-Mail" required>
      <input type="password" id="loginPassword" placeholder="Passwort" required>
      <button class="btn-primary" onclick="login()">Login</button>
    </div>

    <!-- Willkommen -->
    <div id="welcomeMessage" class="welcome-message hidden"></div>

    <!-- Upload (nur Owner) -->
    <div id="uploadSection" class="box hidden">
      <h2>üì§ Neues Lua Script hochladen</h2>
      <form onsubmit="uploadScript(event)">
        <input type="text" id="scriptName" placeholder="Script Name" required>
        <textarea id="scriptDescription" placeholder="Beschreibung..." rows="3"></textarea>
        <textarea id="scriptCode" placeholder="-- Dein Lua Script hier..." rows="8" required></textarea>
        <button type="submit" class="btn-primary">Script hochladen</button>
      </form>
    </div>

    <!-- Scripts -->
    <div id="scriptsContainer"></div>
  </div>

  <script>
    // Fester Owner
    const OWNER = {
      username: "Nubbihax",
      email: "kim259029@gmail.com"
    };

    let currentUser = null;
    let users = JSON.parse(localStorage.getItem("users") || "[]");
    let scripts = JSON.parse(localStorage.getItem("scripts") || "[]");

    // Registrierung
    function register() {
      const username = document.getElementById("regUsername").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const password = document.getElementById("regPassword").value.trim();

      if (!username || !email || !password) {
        alert("Bitte alle Felder ausf√ºllen!");
        return;
      }

      if (users.find(u => u.email === email)) {
        alert("E-Mail ist bereits registriert!");
        return;
      }

      users.push({ username, email, password });
      localStorage.setItem("users", JSON.stringify(users));
      alert("Registrierung erfolgreich! Bitte logge dich ein.");
      showLogin();
    }

    // Login
    function login() {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();

      const user = users.find(u => u.email === email && u.password === password);

      if (!user) {
        alert("Falsche E-Mail oder Passwort!");
        return;
      }

      currentUser = user;
      localStorage.setItem("currentUser", JSON.stringify(user));
      showApp();
    }

    // Nachladen falls schon eingeloggt
    window.onload = () => {
      const savedUser = localStorage.getItem("currentUser");
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showApp();
      }
    };

    // UI Umschalten
    function showApp() {
      document.getElementById("registerBox").classList.add("hidden");
      document.getElementById("loginBox").classList.add("hidden");

      const msg = document.getElementById("welcomeMessage");
      msg.classList.remove("hidden");

      if (currentUser.email === OWNER.email && currentUser.username === OWNER.username) {
        msg.textContent = `üéâ Willkommen, ${currentUser.username}! Du bist als Owner eingeloggt.`;
        msg.className = "welcome-message owner";
        document.getElementById("uploadSection").classList.remove("hidden");
      } else {
        msg.textContent = `üëã Willkommen ${currentUser.username}! Du kannst Scripts lesen und liken.`;
        msg.className = "welcome-message user";
        document.getElementById("uploadSection").classList.add("hidden");
      }

      renderScripts();
    }

    // Script hochladen (nur Owner)
    function uploadScript(event) {
      event.preventDefault();

      if (currentUser.email !== OWNER.email || currentUser.username !== OWNER.username) {
        alert("Nur der Owner darf Scripts hochladen!");
        return;
      }

      const name = document.getElementById("scriptName").value.trim();
      const description = document.getElementById("scriptDescription").value.trim();
      const code = document.getElementById("scriptCode").value.trim();

      const newScript = {
        id: Date.now(),
        name, description, code,
        author: currentUser.username,
        date: new Date().toISOString().split("T")[0],
        likes: 0,
        likedBy: []
      };

      scripts.push(newScript);
      saveScripts();
      renderScripts();
      event.target.reset();
    }

    // Liken
    function toggleLike(scriptId) {
      const script = scripts.find(s => s.id === scriptId);
      if (!script) return;

      if (!currentUser) {
        alert("Bitte zuerst einloggen!");
        return;
      }

      if (!script.likedBy) script.likedBy = [];

      const alreadyLiked = script.likedBy.includes(currentUser.email);

      if (alreadyLiked) {
        script.likes--;
        script.likedBy = script.likedBy.filter(e => e !== currentUser.email);
      } else {
        script.likes++;
        script.likedBy.push(currentUser.email);
      }

      saveScripts();
      renderScripts();
    }

    // Scripts anzeigen (sortiert nach Likes)
    function renderScripts() {
      const container = document.getElementById("scriptsContainer");
      container.innerHTML = "";

      // Nach Likes sortieren
      const sorted = [...scripts].sort((a, b) => b.likes - a.likes);

      sorted.forEach(s => {
        const div = document.createElement("div");
        div.className = "script-card";
        const liked = s.likedBy && s.likedBy.includes(currentUser?.email);

        div.innerHTML = `
          <h3>${s.name}</h3>
          <p><strong>Beschreibung:</strong> ${s.description}</p>
          <pre><code>${escapeHtml(s.code)}</code></pre>
          <p>üë§ ${s.author} | üìÖ ${s.date}</p>
          <button class="btn-like" onclick="toggleLike(${s.id})">
            ‚ù§Ô∏è ${s.likes} ${liked ? "(Entfernen)" : "(Like)"}
          </button>
        `;
        container.appendChild(div);
      });
    }

    // Escape f√ºr Code
    function escapeHtml(text) {
      return text.replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;");
    }

    // Speichern
    function saveScripts() {
      localStorage.setItem("scripts", JSON.stringify(scripts));
    }

    // Login anzeigen nach Registrierung
    function showLogin() {
      document.getElementById("registerBox").classList.add("hidden");
      document.getElementById("loginBox").classList.remove("hidden");
    }
  </script>
</body>
</html>
